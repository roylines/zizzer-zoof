var app=angular.module("app",["ngRoute","services"]),services=angular.module("services",["ngResource"]);app.config(["$routeProvider","$locationProvider","$httpProvider",function(e,t,n){t.html5Mode(!0);for(var o=["login","selling","signup"],r=0;r<o.length;++r){var a={title:"Zizzer-Zoof: "+o[r],templateUrl:"/partial/"+o[r],controller:o[r]};e.when("/"+o[r],a)}e.otherwise({title:"Zizzer-Zoof",templateUrl:"/partial/landing",controller:"landing"});var i=["$q",function(e){function t(e){return e}function n(t){var n=t.status;return 401==n?void(window.location="/"):e.reject(t)}return function(e){return e.then(t,n)}}];n.responseInterceptors.push(i)}]),app.run(["$location","$rootScope",function(e,t){t.$on("$routeChangeSuccess",function(e,n){t.title=n.title})}]),services.factory("Login",["$resource",function(e){return e("/api/1/login")}]),services.factory("Logout",["$resource",function(e){return e("/api/1/logout")}]),services.factory("Items",["$resource",function(e){return e("/api/1/items/:id")}]),services.factory("Users",["$resource",function(e){return e("/api/1/users")}]),app.directive("fileInput",["$parse",function(){return{restrict:"EA",template:"<input class='hidden' type='file' name='image' accept='image/*' capture='camera' />",replace:!0,link:function(e,t,n){e.$watch("state",function(){"choose"==e.state&&(e.state="choosing",t[0].click())}),t.bind("change",function(t){e[n.onChange](t.target.files[0])})}}}]),app.directive("mainFooter",[function(){return{restrict:"E",templateUrl:"/partial/footer",replace:!0}}]),app.directive("map",[function(){return{restrict:"EA",template:"<div class='map'></div>",replace:!0,link:function(e,t){var n,o=function(){if(void 0!==e.center){var o=new google.maps.LatLng(e.center.lat,e.center.lng);if(n)n.setCenter(o);else{var r={zoom:15,center:o};n=new google.maps.Map(t[0],r)}}};e.$watch("center",o,!0)}}}]),app.directive("mainNavigation",[function(){return{restrict:"E",templateUrl:"/partial/nav",replace:!0}}]),app.controller("landing",["$scope",function(){}]),app.controller("login",["$scope","$location","Login",function(e,t,n){e.busy=!1;var o=function(){t.path("/selling")},r=function(t){e.error=t.data,e.busy=!1};e.login=function(t,a){e.busy=!0;var i={email:t,password:a};n.save({},i,o,r)}}]),app.controller("selling",["$scope","Items",function(e,t){e.state="idle",e.choose=function(){e.state="choose"},e.chosen=function(t){var n=new FileReader;n.onloadend=function(){e.$apply(function(){e.newImage=n.result,e.state="chosen"})},n.readAsDataURL(t)},e.forSale=t.query({status:"selling"})}]),app.controller("signup",["$scope","$location","Users",function(e,t,n){var o=function(){t.path("/selling")},r=function(t){e.error=t.data,e.formatted_address=null,e.busy=!1},a=function(t,n){e.$apply(function(){if(e.busy=!1,n==google.maps.GeocoderStatus.OK){if(1!==t.length)return void(e.error="too many locations, please be more specific");console.log(t),e.center={lat:t[0].geometry.location.lat(),lng:t[0].geometry.location.lng()},e.formatted_address=t[0].formatted_address}else e.error=n})};e.search=function(t){e.busy=!0;var n=new google.maps.Geocoder;n.geocode({address:t},a)},e.signup=function(){e.busy=!0;var t={email:e.email,password:e.password,geo:[e.center.lng,e.center.lat]};n.save({},t,o,r)}}]),app.controller("topbar",["$scope","$location","Logout",function(e,t,n){e.logout=function(){n.query(),t.path("/login")}}]);