var app=angular.module("app",["ngRoute","services"]),services=angular.module("services",["ngResource"]);app.config(["$routeProvider","$locationProvider","$httpProvider",function(e,n,o){n.html5Mode(!0);for(var t=["login","selling","signup"],r=0;r<t.length;++r){var a={templateUrl:"/partial/"+t[r],controller:t[r]};e.when("/"+t[r],a)}e.otherwise({redirectTo:"/signup"});var i=["$q",function(e){function n(e){return e}function o(n){var o=n.status;return 401==o?void(window.location="/signup"):e.reject(n)}return function(e){return e.then(n,o)}}];o.responseInterceptors.push(i)}]),services.factory("Login",["$resource",function(e){return e("/api/1/login")}]),services.factory("Logout",["$resource",function(e){return e("/api/1/logout")}]),services.factory("Items",["$resource",function(e){return e("/api/1/items/:id")}]),services.factory("Users",["$resource",function(e){return e("/api/1/users")}]),app.directive("fileInput",["$parse",function(){return{restrict:"EA",template:"<input class='hidden' type='file' name='image' accept='image/*' capture='camera' />",replace:!0,link:function(e,n,o){e.$watch("state",function(){"choose"==e.state&&(e.state="choosing",n[0].click())}),n.bind("change",function(n){e[o.onChange](n.target.files[0])})}}}]),app.directive("map",[function(){return{restrict:"EA",template:"<div class='map'></div>",replace:!0,link:function(e,n){var o,t=function(){if(void 0!==e.center){var t=new google.maps.LatLng(e.center.lat,e.center.lng);if(o)o.setCenter(t);else{var r={zoom:15,center:t};o=new google.maps.Map(n[0],r)}}};e.$watch("center",t,!0)}}}]),app.controller("login",["$scope","$location","Login",function(e,n,o){e.busy=!1;var t=function(){n.path("/selling")},r=function(n){e.error=n.data,e.busy=!1};e.login=function(n,a){e.busy=!0;var i={email:n,password:a};o.save({},i,t,r)}}]),app.controller("selling",["$scope","Items",function(e,n){e.state="idle",e.choose=function(){e.state="choose"},e.chosen=function(n){var o=new FileReader;o.onloadend=function(){e.$apply(function(){e.newImage=o.result,e.state="chosen"})},o.readAsDataURL(n)},e.forSale=n.query({status:"selling"})}]),app.controller("signup",["$scope","$location","Users",function(e,n,o){var t=function(){n.path("/selling")},r=function(n){e.error=n.data,e.formatted_address=null,e.busy=!1},a=function(n,o){e.$apply(function(){if(e.busy=!1,o==google.maps.GeocoderStatus.OK){if(1!==n.length)return void(e.error="too many locations, please be more specific");console.log(n),e.center={lat:n[0].geometry.location.lat(),lng:n[0].geometry.location.lng()},e.formatted_address=n[0].formatted_address}else e.error=o})};e.search=function(n){e.busy=!0;var o=new google.maps.Geocoder;o.geocode({address:n},a)},e.signup=function(){e.busy=!0;var n={email:e.email,password:e.password,geo:[e.center.lng,e.center.lat]};o.save({},n,t,r)}}]),app.controller("topbar",["$scope","$location","Logout",function(e,n,o){e.logout=function(){o.query(),n.path("/login")}}]);